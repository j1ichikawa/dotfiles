--FBM002_E-00

declare
	@KAISHA_CD [nvarchar](2),
	@EDI_KIGYO_CD [nvarchar](10)

set @KAISHA_CD    = 'HK'
set	@EDI_KIGYO_CD = '12345'
--set	@EDI_KIGYO_CD = '1000000000'
--set	@EDI_KIGYO_CD = '2000000000'
--set	@EDI_KIGYO_CD = '1700000000'
--set	@EDI_KIGYO_CD = 'AEON000001'

--------------------------------------------------------------------------------
SELECT TOP (
	SELECT
		COUNT(ROWID)
	FROM
		M_EDI_DEFAULT_PARAM
	WHERE
		KAISHA_CD = @KAISHA_CD
	)
	ROWID,
	FLG,	-- 0: from BIZ_PARAM, 1: from EDI Defaults
	KAISHA_CD,
	SEGMENT,
	PARAM_SECTION,
	@EDI_KIGYO_CD AS PARAM_NAME,	--//DEBUG
	COMMENTS,
	PARAM_VALUE,
	TOROKU_TM,
	TOROKU_TAMMATSU,
	HENKO_TM,
	HENKO_TAMMATSU
FROM
	(
SELECT
		0 AS FLG,
		M_BIZ_PARAM.ROWID,
		M_BIZ_PARAM.KAISHA_CD,
		M_BIZ_PARAM.SEGMENT,
		M_BIZ_PARAM.PARAM_SECTION,
		M_BIZ_PARAM.PARAM_NAME,
		LEFT(M_BIZ_PARAM.COMMENTS, 20) AS COMMENTS,
		LEFT(M_BIZ_PARAM.PARAM_VALUE, 20) AS PARAM_VALUE,
		M_BIZ_PARAM.TOROKU_TM,
		M_BIZ_PARAM.TOROKU_TAMMATSU,
		M_BIZ_PARAM.HENKO_TM,
		M_BIZ_PARAM.HENKO_TAMMATSU
	FROM
		M_BIZ_PARAM
	WHERE
		M_BIZ_PARAM.KAISHA_CD = @KAISHA_CD

	AND	M_BIZ_PARAM.SEGMENT = 'EDI'
	AND	M_BIZ_PARAM.PARAM_NAME = @EDI_KIGYO_CD

UNION ALL
	SELECT
		1 AS FLG,
		M_EDI_DEFAULT_PARAM.ROWID,
		M_EDI_DEFAULT_PARAM.KAISHA_CD,
		M_EDI_DEFAULT_PARAM.SEGMENT,
		M_EDI_DEFAULT_PARAM.PARAM_SECTION,
		'' AS PARAM_NAME,
		LEFT(M_EDI_DEFAULT_PARAM.COMMENTS, 20) AS COMMENTS,
		'' AS PARAM_VALUE,
		M_EDI_DEFAULT_PARAM.TOROKU_TM,
		M_EDI_DEFAULT_PARAM.TOROKU_TAMMATSU,
		M_EDI_DEFAULT_PARAM.HENKO_TM,
		M_EDI_DEFAULT_PARAM.HENKO_TAMMATSU
	FROM
		M_EDI_DEFAULT_PARAM
	WHERE
		M_EDI_DEFAULT_PARAM.KAISHA_CD = @KAISHA_CD

) AS U_BIZ_PARAM
ORDER BY
	U_BIZ_PARAM.FLG ASC,
	U_BIZ_PARAM.SEGMENT ASC,
	U_BIZ_PARAM.PARAM_SECTION ASC

